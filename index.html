<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Embedded Game</title>
  <style>
    body { margin: 0; font-family: system-ui, Arial, sans-serif; }
    .wrap { padding: 12px; }
    button { padding: 10px 12px; font-size: 16px; }
    .log { margin-top: 12px; padding: 10px; background: #f3f3f3; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h3>Iframe Game Demo</h3>

    <button id="dieBtn">Trigger Death</button>
    <button id="winBtn">Trigger Win</button>

    <div class="log" id="log">Status: alive</div>
  </div>

  <script>
    const IFRAME_ORIGIN = window.location.origin;

    const PARENT_ORIGIN = "https://chooseyourstory.com/story/viewer/default.aspx?StoryId=74558&pageId=1";

    let ended = false;

    function log(msg) {
      document.getElementById("log").textContent = msg;
    }


    function sendToParent(type, payload = {}) {
      if (ended) return;
      ended = true;

      const message = {
        type,                
        payload,             
        iframeOrigin: IFRAME_ORIGIN,
        ts: Date.now()
      };
function gotoCYS(pageId) {
  
  window.top.location.href =
    "https://chooseyourstory.com/story/viewer/default.aspx?StoryId=74558&PageId=3";
      
      sendToParent("CYS_DEATH");

      log("Sent message to parent: " + type);
    }

    
    document.getElementById("dieBtn").addEventListener("click", () => {
      sendToParent("CYS_DEATH", { reason: "button" });
    });

    document.getElementById("winBtn").addEventListener("click", () => {
      sendToParent("CYS_WIN", { reason: "button" });
    });

    
    let t = 20;
    const timer = setInterval(() => {
      if (ended) { clearInterval(timer); return; }
      t--;
      log("Status: alive (death in " + t + "s)");
      if (t <= 0) {
        clearInterval(timer);
        sendToParent("CYS_DEATH", { reason: "timer" });
      }
    }, 1000);

   
  </script>
</body>
</html>
